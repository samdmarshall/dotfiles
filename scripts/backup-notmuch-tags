#!/usr/bin/env bash
export NOTMUCH_CONFIG="/home/samantha/.config/notmuch/notmuch-config"

timestamp=`date "+%s"`
output_path="/home/samantha/eMail-backups/$timestamp.gz"
/usr/bin/notmuch dump --gzip --output="$output_path"

backup_files=`ls /home/samantha/eMail-backups/`
for backup in $backup_files ; do
    extension="${backup##*.}"
    filename="${backup%.*}"

    backup_age=`echo "$timestamp - $filename" | bc`
    if [[ $backup_age -gt 86400 ]]; then
        rm "/home/samantha/eMail-backups/$backup"
    fi
done
